import {Injectable} from '@angular/core';
import {Observable} from 'rxjs';

@Injectable({
    providedIn: 'root'
})
class AuthService {
    users: Array<User>;

    constructor() {
        this.users = [
            {
                username: 'root',
                password: '111111',
                image:
                    'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMTguNTQgMzE4LjU0Ij48cGF0aCBkPSJNMzAzLjQ2IDI1My4xYy0xMS4xNS0zNy43Ni02Ny4xMi0zMy41Ny05MS4yOC00NC40MS0yNC4xNS0xMC44NC0yMC4zOC00Ny4yMi0yMy40NS01My41NUgxMjkuOGMtMy4wNiA2LjMzLjcyIDQyLjcxLTIzLjQ1IDUzLjU1LTI0LjE1IDEwLjg0LTgwLjEzIDYuNjUtOTEuMjggNDQuNC02LjE1IDIwLjgzLTUuODUgMjcuMi03LjU1IDUwLjI3IDAgMCA3Ni44IDE1LjE4IDE1MC4wMSAxNS4xOHMxNTMuNS0xNS4xOCAxNTMuNS0xNS4xOGMtMS43MS0yMy4wOC0xLjQyLTI5LjQ0LTcuNTctNTAuMjZ6IiBmaWxsPSIjZWFlNWRjIi8+PHBhdGggZD0iTTE4MC45NyAyMTdjMjQuMTYgMTAuODQgODAuMTQgNi42NiA5MS4yOCA0NC40IDUuODYgMTkuODQgNS44NyAyNi41NiA3LjMyIDQ3LjA4YTg0Ny42NiA4NDcuNjYgMCAwIDAgMzEuNDUtNS4xMmMtMS43LTIzLjA3LTEuNC0yOS40NC03LjU2LTUwLjI2LTExLjE1LTM3Ljc2LTY3LjEyLTMzLjU3LTkxLjI4LTQ0LjQxLTI0LjE1LTEwLjg0LTIwLjM4LTQ3LjIyLTIzLjQ0LTUzLjU1aC0zMS4yMXMtLjcyIDUxLjAyIDIzLjQ0IDYxLjg2eiIgZmlsbD0iI2UwZGJkMyIvPjxwYXRoIGQ9Ik0yMDEuNjcgMjAwLjY4Yy0xMi41LTE0Ljk1LTEwLjQyLTQwLjM1LTEyLjkzLTQ1LjU1SDEyOS44Yy0yLjUxIDUuMi0uNDIgMzAuNi0xMi45MiA0NS41NSA1Ljk2IDE0LjAzIDM3Ljk5IDUxLjU4IDQyLjQgNTEuNTggNC40IDAgMzUuOTMtMzYuNCA0Mi4zOS01MS41OHoiIGZpbGw9IiNlOGM1OWUiLz48cGF0aCBkPSJNMTIxLjg3IDE5Mi43NGM5Ljc4IDcuOTUgMjEuMjQgMTUuODUgMzcuMzQgMTguMTMgMTYuMTQtMi4yOSAyNy41Ny0xMC4zNCAzNy4zNi0xOC4zNC04LjE0LTE0Ljk3LTUuNjMtMzIuODMtNy44My0zNy40SDEyOS44Yy0yLjIxIDQuNTguMjUgMjIuNjMtNy45MyAzNy42eiIgZmlsbD0iI2M2OWU3ZiIvPjxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKDEwMC4yIDIyOC4zMSAxMTguMTMpIiBjeD0iMjI4LjMxIiBjeT0iMTE4LjE0IiByeD0iMjEuMzkiIHJ5PSIxMS42MyIgZmlsbD0iI2RkYjU4ZSIvPjxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKDE2OS44IDkwLjA1IDExOC4xNCkiIGN4PSI5MC4wNSIgY3k9IjExOC4xNCIgcng9IjExLjYzIiByeT0iMjEuMzkiIGZpbGw9IiNlOGM1OWUiLz48cGF0aCBkPSJNMjIzLjQzIDQ2Ljk0bC02My42NSA5LjIyLTY1LjQtOC4zM1M4OC45IDc5LjY2IDg4LjkgOTQuMjdjMCA0NC4xOCA3LjkzIDEwNC42NCA3MC4zIDExMy40OCAxMDAuMjItMTQuMiA2NC4yMy0xNjAuOCA2NC4yMy0xNjAuOHoiIGZpbGw9IiNlOGM1OWUiLz48cGF0aCBkPSJNMTU5LjIgMjA3Ljc1YzEwMC4yMy0xNC4yIDY0LjIzLTE2MC44IDY0LjIzLTE2MC44aC0xNS4wMmM0LjExIDYxLjI0IDkuOCA5My43Ny0xMy44MiAxMjkuMjMtMTguNzIgMjguMS0zNS4zOCAzMS41Ny0zNS4zOCAzMS41N3oiIGZpbGw9IiNkZGI1OGUiLz48cGF0aCBkPSJNMjMxLjYxIDUzLjYzYy0zLjM2LTIyLjg2LTIyLjY4LTQ5LjQ3LTcyLjQtNDkuNDdzLTY4IDI4LjMtNzIuNCA0OS40N2MtMy40MyAxNi40MyA4Ljg0IDM2LjQ1IDguODQgMzYuNDUtMS0xMC43LTEuMDctMjQuNzcgNC4zNy0zMC4yMiA5LjI4LTkuMjcgNTkuOCA4Ljg5IDU5LjggOC44OXM1MS4xMy0xNi4zMyA1OC41OC04Ljg5YzQuNCA0LjQxIDQuNDggMTguODggMy44IDI5Ljk1IDAgMCAxMi4wNy0xOC4xIDkuNDEtMzYuMTh6IiBmaWxsPSIjZGRiNThlIi8+PHBhdGggZD0iTTIzMS42MSA0OS40N0MyMjguMjUgMjYuNjEgMjA4LjkzIDAgMTU5LjIxIDBzLTY4IDI4LjMtNzIuNCA0OS40N2MtMy40MyAxNi40My0yLjU1IDM1LjA3LS45NyA0Ny43MiA0LjM0LS40NyA4LjYxLjcyIDExLjY3IDIuMSAwIDAtNi43Ni0zNC4zIDIuNTEtNDMuNThzNTkuOCA4Ljg4IDU5LjggOC44OCA1MS4xMy0xNi4zMiA1OC41OC04Ljg4IDIuNTIgNDMuNTggMi41MiA0My41OGMzLjA1LTEuMzggNy4zMi0yLjU3IDExLjY2LTIuMSAxLjctMTUuMjkgMS43LTI5LjYzLS45Ny00Ny43MnoiIGZpbGw9IiM1MTUxNTEiLz48cGF0aCBkPSJNMTU4LjU0IDE1My4wMWMtMTQuMiAwLTMxLjA2LS40My00Mi41OSAyLjI0LTEzLjYgMy4xNi0yMC43IDkuNS0yMC43IDkuNSAyLjcyLTEuMjcgMTEuODgtMy4yIDE5LjYtLjQ1IDkuMzMgMy4zMyAyNS41IDEzLjczIDQzLjY4LTYuNDIgMTguMiAyMC4xNSAzNC4zNiA5Ljc1IDQzLjcgNi40MiA3LjcyLTIuNzYgMTYuODctLjgzIDE5LjU5LjQ1IDAgMC05LjQ3LTcuNTYtMjMuMDctMTAuNzItMTEuNTItMi42Ny0yNi0xLjAyLTQwLjIxLTEuMDJ6IiBmaWxsPSIjZGRiNThlIi8+PHBhdGggZD0iTTIyNC4xNiAxNDguNTNzLTEyLjc0IDI5LjYtNDIuNCA0MC42OWwuMDQtLjFjLTE2LjM1IDUuMTMtMjMuMjctMTIuMS0yMy4yNy0xMi4xcy02LjkgMTcuMjQtMjMuMjcgMTIuMWguMDFjLTI4Ljk1LTExLjE0LTQwLjIzLTQwLjYtNDAuMjMtNDAuNnMuNDUgMS45Mi42NiA0LjljLjQ1IDYuMzMuOTQgMTcuNS0uNDEgMjUuNDRDOTIuNTMgMTk1IDkwIDIwOCA5OS45NiAyMjMuNzhjOC43NyAxMy45MiAyMi43NSAyNi41OCA0OSAzMS4xOCA0Ni4wNSA4LjA3IDYxLjE0LTExLjk1IDYxLjE0LTExLjk1cy0yNC40Ny0zLjI5LTIzLjQ1LTEwLjE3YzEuMDMtNi44OCA2LjE2LTMuODkgMjAuNjUtMTMuMTYgMTQuNS05LjI3IDE3LjQxLTI5IDE0LjA0LTQyLjE2LTIuMTQtOC4zMi0uMDYtMTcuNCAxLjQ3LTIzLjE4LjktMy4zNiAxLjM1LTUuODEgMS4zNS01LjgxeiIgZmlsbD0iIzUxNTE1MSIvPjxwYXRoIGQ9Ik0xODYuNjYgMjMyLjg0YzEuMDItNi44OCA2LjE2LTMuODggMjAuNjUtMTMuMTUgMTQuNDktOS4yNyAxNy40LTI5IDE0LjA0LTQyLjE2LTIuMTQtOC4zMi0uMDctMTcuNCAxLjQ3LTIzLjE5LjktMy4zNiAxLjM1LTUuODEgMS4zNS01Ljgxcy04LjQ4IDIxLjQzLTguOTcgMzcuNmMtLjYzIDIwLjgtMTguNDYgMjcuNzYtNDAuNjIgMzMuMzQtMTEuNSAyLjktMTAuNzIgMTYuMDItMS41MyAyMi44NSA4LjUyIDYuMzIgMjQuNTggNi43NCAzNy4wNi43IDAgMC0yNC40OC0zLjMtMjMuNDUtMTAuMTh6IiBmaWxsPSIjNDY0NzQ3Ii8+PHBhdGggZD0iTTE2Mi4zMSAxNDIuMWwtMy44MSAxLjE2LTMuNzMtMS4xNnMtMzUuODItOS4yLTU5LjUgMjIuNjVjMCAwIDEwLjE3LTUuNiAxOS41OC0yLjI1IDkuMzQgMy4zNCAyNS41IDExLjk0IDQzLjctOC4yIDE4LjE4IDIwLjE0IDM0LjM0IDExLjU0IDQzLjY4IDguMiA5LjQyLTMuMzYgMTkuNiAyLjI1IDE5LjYgMi4yNS0yMy43LTMxLjg0LTU5LjUyLTIyLjY2LTU5LjUyLTIyLjY2eiIgZmlsbD0iIzUxNTE1MSIvPjwvc3ZnPg=='
            }
        ];
    }

    login(username: string, password: string) {
        return new Observable((observer) => {
            let loginUser = this.users.find((user) => {
                return user.username === username && user.password === password;
            });
            if (loginUser) {
                localStorage.setItem('authenticatedUsername', loginUser.username);
                observer.next();
            } else {
                observer.error('Incorrect credentials. Try again.')
            }
        });
    }

    logout() {
        return new Observable((observer) => {
            localStorage.removeItem('authenticatedUsername');
            observer.next();
        });
    }

    getAuthenticatedUser() {
        return new Observable((observer) => {
            let authenticatedUsername = localStorage.getItem('authenticatedUsername');
            observer.next(
                this.users.find((user) => {
                    return user.username === authenticatedUsername;
                })
            );
        });
    }
}

export {AuthService};
